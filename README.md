# MoviePilot-Plugins
MoviePilotå®˜æ–¹æ’ä»¶å¸‚åœºï¼šhttps://github.com/jxxghp/MoviePilot-Plugins

## ç›®å½•
- [ç¬¬ä¸‰æ–¹æ’ä»¶åº“å¼€å‘è¯´æ˜](#ç¬¬ä¸‰æ–¹æ’ä»¶åº“å¼€å‘è¯´æ˜)
  - [1. ç›®å½•ç»“æ„](#1-ç›®å½•ç»“æ„)
  - [2. æ’ä»¶å›¾æ ‡](#2-æ’ä»¶å›¾æ ‡)
  - [3. æ’ä»¶å‘½å](#3-æ’ä»¶å‘½å)
  - [4. ä¾èµ–](#4-ä¾èµ–)
  - [5. ç•Œé¢å¼€å‘](#5-ç•Œé¢å¼€å‘)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)
  - [1. å¦‚ä½•æ‰©å±•æ¶ˆæ¯æ¨é€æ¸ é“ï¼Ÿ](#1-å¦‚ä½•æ‰©å±•æ¶ˆæ¯æ¨é€æ¸ é“)
  - [2. å¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿œç¨‹å‘½ä»¤å“åº”ï¼Ÿ](#2-å¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿œç¨‹å‘½ä»¤å“åº”)
  - [3. å¦‚ä½•åœ¨æ’ä»¶ä¸­å¯¹å¤–æš´éœ²APIï¼Ÿ](#3-å¦‚ä½•åœ¨æ’ä»¶ä¸­å¯¹å¤–æš´éœ²api)
  - [4. å¦‚ä½•åœ¨æ’ä»¶ä¸­æ³¨å†Œå…¬å…±å®šæ—¶æœåŠ¡ï¼Ÿ](#4-å¦‚ä½•åœ¨æ’ä»¶ä¸­æ³¨å†Œå…¬å…±å®šæ—¶æœåŠ¡)
  - [5. å¦‚ä½•é€šè¿‡æ’ä»¶å¢å¼ºMoviePilotçš„è¯†åˆ«åŠŸèƒ½ï¼Ÿ](#5-å¦‚ä½•é€šè¿‡æ’ä»¶å¢å¼ºmoviepilotçš„è¯†åˆ«åŠŸèƒ½)
  - [6. å¦‚ä½•æ‰©å±•å†…å»ºç´¢å¼•å™¨çš„ç´¢å¼•ç«™ç‚¹ï¼Ÿ](#6-å¦‚ä½•æ‰©å±•å†…å»ºç´¢å¼•å™¨çš„ç´¢å¼•ç«™ç‚¹)
  - [7. å¦‚ä½•åœ¨æ’ä»¶ä¸­è°ƒç”¨APIæ¥å£ï¼Ÿ](#7-å¦‚ä½•åœ¨æ’ä»¶ä¸­è°ƒç”¨apiæ¥å£)
  - [8. å¦‚ä½•å°†æ’ä»¶å†…å®¹æ˜¾ç¤ºåˆ°ä»ªè¡¨æ¿ï¼Ÿ](#8-å¦‚ä½•å°†æ’ä»¶å†…å®¹æ˜¾ç¤ºåˆ°ä»ªè¡¨æ¿)
  - [9. å¦‚ä½•æ‰©å±•æ¢ç´¢åŠŸèƒ½çš„åª’ä½“æ•°æ®æºï¼Ÿ](#9-å¦‚ä½•æ‰©å±•æ¢ç´¢åŠŸèƒ½çš„åª’ä½“æ•°æ®æº)
  - [10. å¦‚ä½•æ‰©å±•æ¨èåŠŸèƒ½çš„åª’ä½“æ•°æ®æºï¼Ÿ](#10-å¦‚ä½•æ‰©å±•æ¨èåŠŸèƒ½çš„åª’ä½“æ•°æ®æº)
  - [11. å¦‚ä½•é€šè¿‡æ’ä»¶é‡è½½å®ç°ç³»ç»Ÿæ¨¡å—åŠŸèƒ½ï¼Ÿ](#11-å¦‚ä½•é€šè¿‡æ’ä»¶é‡è½½å®ç°ç³»ç»Ÿæ¨¡å—åŠŸèƒ½)
  - [12. å¦‚ä½•é€šè¿‡æ’ä»¶æ‰©å±•æ”¯æŒçš„å­˜å‚¨ç±»å‹ï¼Ÿ](#12-å¦‚ä½•é€šè¿‡æ’ä»¶æ‰©å±•æ”¯æŒçš„å­˜å‚¨ç±»å‹)
  - [13. å¦‚ä½•å°†æ’ä»¶åŠŸèƒ½é›†æˆåˆ°å·¥ä½œæµï¼Ÿ](#13-å¦‚ä½•å°†æ’ä»¶åŠŸèƒ½é›†æˆåˆ°å·¥ä½œæµ)
  - [14. å¦‚ä½•åœ¨æ’ä»¶ä¸­é€šè¿‡æ¶ˆæ¯æŒç»­ä¸ç”¨æˆ·äº¤äº’ï¼Ÿ](#14-å¦‚ä½•åœ¨æ’ä»¶ä¸­é€šè¿‡æ¶ˆæ¯æŒç»­ä¸ç”¨æˆ·äº¤äº’)
  - [15. å¦‚ä½•åœ¨æ’ä»¶ä¸­ä½¿ç”¨ç³»ç»Ÿçº§ç»Ÿä¸€ç¼“å­˜ï¼Ÿ](#15-å¦‚ä½•åœ¨æ’ä»¶ä¸­ä½¿ç”¨ç³»ç»Ÿçº§ç»Ÿä¸€ç¼“å­˜)
- [ç‰ˆæœ¬å‘å¸ƒ](#ç‰ˆæœ¬å‘å¸ƒ)
  - [1. å¦‚ä½•å‘å¸ƒæ’ä»¶ç‰ˆæœ¬ï¼Ÿ](#1-å¦‚ä½•å‘å¸ƒæ’ä»¶ç‰ˆæœ¬)
  - [2. å¦‚ä½•å¼€å‘V2ç‰ˆæœ¬çš„æ’ä»¶ä»¥åŠå®ç°æ’ä»¶å¤šç‰ˆæœ¬å…¼å®¹ï¼Ÿ](#2-å¦‚ä½•å¼€å‘v2ç‰ˆæœ¬çš„æ’ä»¶ä»¥åŠå®ç°æ’ä»¶å¤šç‰ˆæœ¬å…¼å®¹)

## ç¬¬ä¸‰æ–¹æ’ä»¶åº“å¼€å‘è¯´æ˜
> è¯·ä¸è¦å¼€å‘ç”¨äºç ´è§£MoviePilotç”¨æˆ·è®¤è¯ã€è‰²æƒ…ã€èµŒåšç­‰è¿æ³•è¿è§„å†…å®¹çš„æ’ä»¶ï¼Œå…±åŒç»´æŠ¤å¥åº·çš„å¼€å‘ç¯å¢ƒï¼


### 1. ç›®å½•ç»“æ„
- æ’ä»¶ä»“åº“éœ€è¦ä¿æŒä¸æœ¬é¡¹ç›®ä¸€è‡´çš„ç›®å½•ç»“æ„ï¼ˆå»ºè®®forkåä¿®æ”¹ï¼‰ï¼Œä»…æ”¯æŒGithubä»“åº“ï¼Œ`plugins`å­˜æ”¾æ’ä»¶ä»£ç ï¼Œä¸€ä¸ªæ’ä»¶ä¸€ä¸ªå­ç›®å½•ï¼Œ**å­ç›®å½•åå¿…é¡»ä¸ºæ’ä»¶ç±»åçš„å°å†™**ï¼Œæ’ä»¶ä¸»ç±»åœ¨`__init__.py`ä¸­ç¼–å†™ã€‚
- `package.json`ä¸ºæ’ä»¶ä»“åº“ä¸­æ‰€æœ‰æ’ä»¶æ¦‚è¦ä¿¡æ¯ï¼Œç”¨äºåœ¨MoviePilotçš„æ’ä»¶å¸‚åœºæ˜¾ç¤ºï¼Œå…¶ä¸­ç‰ˆæœ¬å·ç­‰éœ€ä¸æ’ä»¶ä»£ç ä¿æŒä¸€è‡´ï¼Œé€šè¿‡ä¿®æ”¹ç‰ˆæœ¬å·å¯è§¦å‘MoviePilotæ˜¾ç¤ºæ’ä»¶æ›´æ–°ã€‚ 

### 2. æ’ä»¶å›¾æ ‡
- æ’ä»¶å›¾æ ‡å¯å¤ç”¨å®˜æ–¹æ’ä»¶åº“ä¸­`icons`ä¸‹å·²æœ‰å›¾æ ‡ï¼Œå¦åˆ™éœ€ä½¿ç”¨å®Œæ•´çš„httpæ ¼å¼çš„urlå›¾ç‰‡é“¾æ¥ï¼ˆåŒ…æ‹¬package.jsonä¸­çš„iconå’Œæ’ä»¶ä»£ç ä¸­çš„plugin_iconï¼‰ã€‚
- æ’ä»¶çš„èƒŒæ™¯é¢œè‰²ä¼šè‡ªåŠ¨æå–ä½¿ç”¨å›¾æ ‡çš„ä¸»è‰²è°ƒã€‚

### 3. æ’ä»¶å‘½å
- æ’ä»¶å‘½åè¯·å‹¿ä¸å®˜æ–¹åº“æ’ä»¶ä¸­çš„æ’ä»¶å†²çªï¼Œå¦åˆ™ä¼šåœ¨MoviePilotç‰ˆæœ¬å‡çº§æ—¶è¢«å®˜æ–¹æ’ä»¶è¦†ç›–ã€‚

### 4. ä¾èµ–
- å¯åœ¨æ’ä»¶ç›®å½•ä¸­æ”¾ç½®`requirements.txt`æ–‡ä»¶ï¼Œç”¨äºæŒ‡å®šæ’ä»¶ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ï¼ŒMoviePilotä¼šåœ¨æ’ä»¶å®‰è£…æ—¶è‡ªåŠ¨å®‰è£…ä¾èµ–åº“ã€‚

### 5. ç•Œé¢å¼€å‘
- æ’ä»¶æ”¯æŒ`æ’ä»¶é…ç½®`ã€`è¯¦æƒ…å±•ç¤º`ã€`ä»ªè¡¨æ¿Widget`ä¸‰ä¸ªå±•ç¤ºé¡µé¢ï¼Œæ”¯æŒä¸¤ç§æ–¹å¼å¼€å‘ï¼š
  1. é€šè¿‡é…ç½®åŒ–çš„æ–¹å¼ç»„è£…ï¼Œä½¿ç”¨ [Vuetify](https://vuetifyjs.com/) ç»„ä»¶åº“ï¼Œæ‰€æœ‰è¯¥ç»„ä»¶åº“æœ‰çš„ç»„ä»¶éƒ½å¯ä»¥é€šè¿‡Jsoné…ç½®ä½¿ç”¨ï¼Œè¯¦æƒ…å‚è€ƒå·²æœ‰æ’ä»¶ã€‚
  - `props`ä¸­`model`å±æ€§ç­‰æ•ˆäºv-modelï¼Œ`show`ç­‰æ•ˆäºv-showï¼Œå…¶å®ƒå±äºä¼šç›´æ¥ç»‘å®šåˆ°å…ƒç´ ä¸Šã€‚
  - æ’ä»¶é…ç½®é¡µé¢propså±æ€§æ”¯æŒè¡¨è¾¾å¼ï¼Œä½¿ç”¨`{{}}`æ¦‚èµ·æ¥ï¼›æ”¯æŒäº‹ä»¶ï¼Œä»¥`on`å¼€å¤´ï¼Œæ¯”å¦‚ï¼šonclickã€‚
  - è¯¦æƒ…å±•ç¤ºé¡µé¢æ”¯æŒAPIè°ƒç”¨,åœ¨`events`å±æ€§ä¸­å®šä¹‰ã€‚
  2. é€šè¿‡Vueç¼–å†™è”é‚¦è¿œç¨‹ç»„ä»¶ï¼Œå‚è€ƒï¼š[æ¨¡å—è”é‚¦å¼€å‘æŒ‡å—](https://github.com/jxxghp/MoviePilot-Frontend/blob/v2/docs/module-federation-guide.md)


## å¸¸è§é—®é¢˜

### 1. å¦‚ä½•æ‰©å±•æ¶ˆæ¯æ¨é€æ¸ é“ï¼Ÿ
- æ³¨å†Œ `NoticeMessage` äº‹ä»¶å“åº”ï¼Œ`event_data` åŒ…å«æ¶ˆæ¯ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå‚è€ƒ `IYUUæ¶ˆæ¯é€šçŸ¥` æ’ä»¶ï¼š

    æ³¨å†Œäº‹ä»¶ï¼š
    ```python
    @eventmanager.register(EventType.NoticeMessage)
    ```

- äº‹ä»¶å¯¹è±¡ï¼š
    ```json
    {
         "channel": MessageChannel|None,
         "type": NotificationType|None,
         "title": str,
         "text": str,
         "image": str,
         "userid": str|int,
    }
    ```
  
- MoviePilotä¸­æ‰€æœ‰äº‹ä»¶æ¸…å•ï¼ˆV2ç‰ˆæœ¬ï¼‰ï¼Œå¯ä»¥é€šè¿‡å®ç°è¿™äº›äº‹æƒ…æ¥æ‰©å±•åŠŸèƒ½ï¼ŒåŒæ—¶æ’ä»¶ä¹‹å‰ä¹Ÿå¯ä»¥é€šè¿‡å‘é€å’Œç›‘å¬äº‹ä»¶å®ç°è”åŠ¨ï¼ˆV1ã€V2äº‹ä»¶æ¸…å•æœ‰å·®å¼‚ï¼Œä¸”å¯èƒ½ä¼šå˜åŒ–ï¼Œæœ€æ–°è¯·å‚è€ƒæºä»£ç ï¼‰ã€‚
```python
# å¼‚æ­¥å¹¿æ’­äº‹ä»¶
class EventType(Enum):
    # æ’ä»¶éœ€è¦é‡è½½
    PluginReload = "plugin.reload"
    # è§¦å‘æ’ä»¶åŠ¨ä½œ
    PluginAction = "plugin.action"
    # æ’ä»¶è§¦å‘äº‹ä»¶
    PluginTriggered = "plugin.triggered"
    # æ‰§è¡Œå‘½ä»¤
    CommandExcute = "command.excute"
    # ç«™ç‚¹å·²åˆ é™¤
    SiteDeleted = "site.deleted"
    # ç«™ç‚¹å·²æ›´æ–°
    SiteUpdated = "site.updated"
    # ç«™ç‚¹å·²åˆ·æ–°
    SiteRefreshed = "site.refreshed"
    # è½¬ç§»å®Œæˆ
    TransferComplete = "transfer.complete"
    # ä¸‹è½½å·²æ·»åŠ 
    DownloadAdded = "download.added"
    # åˆ é™¤å†å²è®°å½•
    HistoryDeleted = "history.deleted"
    # åˆ é™¤ä¸‹è½½æºæ–‡ä»¶
    DownloadFileDeleted = "downloadfile.deleted"
    # åˆ é™¤ä¸‹è½½ä»»åŠ¡
    DownloadDeleted = "download.deleted"
    # æ”¶åˆ°ç”¨æˆ·å¤–æ¥æ¶ˆæ¯
    UserMessage = "user.message"
    # æ”¶åˆ°Webhookæ¶ˆæ¯
    WebhookMessage = "webhook.message"
    # å‘é€æ¶ˆæ¯é€šçŸ¥
    NoticeMessage = "notice.message"
    # è®¢é˜…å·²æ·»åŠ 
    SubscribeAdded = "subscribe.added"
    # è®¢é˜…å·²è°ƒæ•´
    SubscribeModified = "subscribe.modified"
    # è®¢é˜…å·²åˆ é™¤
    SubscribeDeleted = "subscribe.deleted"
    # è®¢é˜…å·²å®Œæˆ
    SubscribeComplete = "subscribe.complete"
    # ç³»ç»Ÿé”™è¯¯
    SystemError = "system.error"
    # åˆ®å‰Šå…ƒæ•°æ®
    MetadataScrape = "metadata.scrape"
    # æ¨¡å—éœ€è¦é‡è½½
    ModuleReload = "module.reload"


# åŒæ­¥é“¾å¼äº‹ä»¶
class ChainEventType(Enum):
    # åç§°è¯†åˆ«
    NameRecognize = "name.recognize"
    # è®¤è¯éªŒè¯
    AuthVerification = "auth.verification"
    # è®¤è¯æ‹¦æˆª
    AuthIntercept = "auth.intercept"
    # å‘½ä»¤æ³¨å†Œ
    CommandRegister = "command.register"
    # æ•´ç†é‡å‘½å
    TransferRename = "transfer.rename"
    # æ•´ç†æ‹¦æˆª
    TransferIntercept = "transfer.intercept"
    # èµ„æºé€‰æ‹©
    ResourceSelection = "resource.selection"
    # èµ„æºä¸‹è½½
    ResourceDownload = "resource.download"
    # å‘ç°æ•°æ®æº
    DiscoverSource = "discover.source"
    # åª’ä½“è¯†åˆ«è½¬æ¢
    MediaRecognizeConvert = "media.recognize.convert"
    # æ¨èæ•°æ®æº
    RecommendSource = "recommend.source"
    # å·¥ä½œæµæ‰§è¡Œ
    WorkflowExecution = "workflow.execution"
    # å­˜å‚¨æ“ä½œé€‰æ‹©
    StorageOperSelection = "storage.operation"
```
  
### 2. å¦‚ä½•åœ¨æ’ä»¶ä¸­å®ç°è¿œç¨‹å‘½ä»¤å“åº”ï¼Ÿ
- å®ç° `get_command()` æ–¹æ³•ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›å‘½ä»¤åˆ—è¡¨ï¼š
    ```json
    [{
        "cmd": "/douban_sync", // åŠ¨ä½œIDï¼Œå¿…é¡»ä»¥/å¼€å§‹
        "event": EventType.PluginAction,// äº‹ä»¶ç±»å‹ï¼Œå›ºå®šå€¼
        "desc": "å‘½ä»¤åç§°",
        "category": "å‘½ä»¤èœå•ï¼ˆå¾®ä¿¡ï¼‰",
        "data": {
            "action": "douban_sync" // åŠ¨ä½œæ ‡è¯†
        }
    }]
    ```

- æ³¨å†Œ `PluginAction` äº‹ä»¶å“åº”ï¼Œæ ¹æ® `event_data.action` æ˜¯å¦ä¸ºæ’ä»¶è®¾å®šçš„åŠ¨ä½œæ ‡è¯†æ¥åˆ¤æ–­æ˜¯å¦ä¸ºæœ¬æ’ä»¶äº‹ä»¶ï¼š

    æ³¨å†Œäº‹ä»¶ï¼š
    ```python
    @eventmanager.register(EventType.PluginAction)
    ```
    
    äº‹ä»¶åˆ¤å®šï¼š
    ```python
    event_data = event.event_data
    if not event_data or event_data.get("action") != "douban_sync":
        return
    ```
  
### 3. å¦‚ä½•åœ¨æ’ä»¶ä¸­å¯¹å¤–æš´éœ²APIï¼Ÿ
- å®ç° `get_api()` æ–¹æ³•ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›APIåˆ—è¡¨ï¼š
    ```json
    [{
        "path": "/refresh_by_domain", // APIè·¯å¾„ï¼Œå¿…é¡»ä»¥/å¼€å§‹
        "endpoint": self.refresh_by_domain, // APIå“åº”æ–¹æ³•
        "methods": ["GET"], // è¯·æ±‚æ–¹å¼ï¼šGET/POST/PUT/DELETE
        "summary": "åˆ·æ–°ç«™ç‚¹æ•°æ®", // APIåç§°
        "description": "åˆ·æ–°å¯¹åº”åŸŸåçš„ç«™ç‚¹æ•°æ®", // APIæè¿°
    }]
    ```
  æ³¨æ„ï¼šåœ¨æ’ä»¶ä¸­æš´éœ²APIæ¥å£æ—¶æ³¨æ„å®‰å…¨æ§åˆ¶ï¼Œæ¨èä½¿ç”¨`settings.API_TOKEN`è¿›è¡Œèº«ä»½éªŒè¯ã€‚
  
- åœ¨å¯¹åº”çš„æ–¹æ³•ä¸­å®ç°APIå“åº”æ–¹æ³•é€»è¾‘ï¼Œé€šè¿‡ `http://localhost:3001/docs` æŸ¥çœ‹APIæ–‡æ¡£å’Œè°ƒè¯•

### 4. å¦‚ä½•åœ¨æ’ä»¶ä¸­æ³¨å†Œå…¬å…±å®šæ—¶æœåŠ¡ï¼Ÿ
- æ³¨å†Œå…¬å…±å®šæ—¶æœåŠ¡åï¼Œå¯ä»¥åœ¨`è®¾å®š-æœåŠ¡`ä¸­æŸ¥çœ‹è¿è¡ŒçŠ¶æ€å’Œæ‰‹åŠ¨å¯åŠ¨ï¼Œæ›´åŠ ä¾¿æ·ã€‚
- å®ç° `get_service()` æ–¹æ³•ï¼ŒæŒ‰ä»¥ä¸‹æ ¼å¼è¿”å›æœåŠ¡æ³¨å†Œä¿¡æ¯ï¼š
    ```json
    [{
        "id": "æœåŠ¡ID", // ä¸èƒ½ä¸å…¶å®ƒæœåŠ¡IDé‡å¤
        "name": "æœåŠ¡åç§°", // æ˜¾ç¤ºåœ¨æœåŠ¡åˆ—è¡¨ä¸­çš„åç§°
        "trigger": "è§¦å‘å™¨ï¼šcron/interval/date/CronTrigger.from_crontab()",
        "func": self.xxx, // æœåŠ¡æ–¹æ³•
        "kwargs": {} // å®šæ—¶å™¨å‚æ•°ï¼Œå‚è€ƒAPScheduler
    }]
    ```

### 5. å¦‚ä½•é€šè¿‡æ’ä»¶å¢å¼ºMoviePilotçš„è¯†åˆ«åŠŸèƒ½ï¼Ÿ
- V1æŒ‰å¦‚ä¸‹æ­¥éª¤å®ç°ï¼ŒV2ç‰ˆæœ¬ç›´æ¥å®ç°å¯¹åº”é“¾å¼äº‹ä»¶å³å¯ï¼Œå‚è€ƒChatGPTæ’ä»¶ã€‚æ³¨æ„ï¼šåªæœ‰ä¸»ç¨‹åºæ— æ³•è¯†åˆ«æ—¶æ‰ä¼šè§¦å‘ã€‚
- æ³¨å†Œ `NameRecognize` äº‹ä»¶ï¼Œå®ç°è¯†åˆ«é€»è¾‘ã€‚
    ```python
    @eventmanager.register(EventType.NameRecognize)
    ```
  
- å®Œæˆè¯†åˆ«åå‘é€ `NameRecognizeResult` äº‹ä»¶ï¼Œå°†è¯†åˆ«ç»“æœæ³¨å…¥ä¸»ç¨‹åº
    ```python
    eventmanager.send_event(
        EventType.NameRecognizeResult,
        {
            'title': title, # åŸä¼ å…¥æ ‡é¢˜
            'name': str, # è¯†åˆ«çš„åç§°
            'year': str, # è¯†åˆ«çš„å¹´ä»½
            'season': int, # è¯†åˆ«çš„å­£å·
            'episode': int, # è¯†åˆ«çš„é›†å·
        }
    )
    ```
  
- æ³¨æ„ï¼šè¯†åˆ«è¯·æ±‚éœ€è¦åœ¨15ç§’å†…å“åº”ï¼Œå¦åˆ™ç»“æœä¼šè¢«ä¸¢å¼ƒï¼›**æ’ä»¶æœªå¯ç”¨æˆ–å‚æ•°ä¸å®Œæ•´æ—¶åº”ç«‹å³å›å¤ç©ºç»“æœäº‹ä»¶ï¼Œé¿å…ä¸»ç¨‹åºç­‰å¾…ï¼›** å¤šä¸ªæ’ä»¶å¼€å¯è¯†åˆ«åŠŸèƒ½æ—¶ï¼Œä»¥å…ˆæ”¶åˆ°çš„è¯†åˆ«ç»“æœäº‹ä»¶ä¸ºå‡†ã€‚
    ```python
    eventmanager.send_event(
        EventType.NameRecognizeResult,
        {
            'title': title # ç»“æœåªå«åŸæ ‡é¢˜ï¼Œä»£è¡¨ç©ºè¯†åˆ«ç»“æœäº‹ä»¶
        }
    )
    ```
  
### 6. å¦‚ä½•æ‰©å±•å†…å»ºç´¢å¼•å™¨çš„ç´¢å¼•ç«™ç‚¹ï¼Ÿ
- é€šè¿‡è°ƒç”¨ `SitesHelper().add_indexer(domain: str, indexer: dict)` æ–¹æ³•ï¼Œæ–°å¢æˆ–ä¿®æ”¹å†…å»ºç´¢å¼•å™¨çš„æ”¯æŒèŒƒå›´ï¼Œå…¶ä¸­`indexer`ä¸ºç«™ç‚¹é…ç½®Jsonï¼Œæ ¼å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š

  ç¤ºä¾‹ä¸€ï¼š
  ```json
  {
    "id": "nyaa",
    "name": "Nyaa",
    "domain": "https://nyaa.si/",
    "encoding": "UTF-8",
    "public": true,
    "proxy": true,
    "result_num": 100,
    "timeout": 30,
    "search": {
      "paths": [
        {
          "path": "?f=0&c=0_0&q={keyword}",
          "method": "get"
        }
      ]
    },
    "browse": {
      "path": "?p={page}",
      "start": 1
    },
    "torrents": {
      "list": {
        "selector": "table.torrent-list > tbody > tr"
      },
      "fields": {
        "id": {
          "selector": "a[href*=\"/view/\"]",
          "attribute": "href",
          "filters": [
            {
              "name": "re_search",
              "args": [
                "\\d+",
                0
              ]
            }
          ]
        },
        "title": {
          "selector": "td:nth-child(2) > a"
        },
        "details": {
          "selector": "td:nth-child(2) > a",
          "attribute": "href"
        },
        "download": {
          "selector": "td:nth-child(3) > a[href*=\"/download/\"]",
          "attribute": "href"
        },
        "date_added": {
          "selector": "td:nth-child(5)"
        },
        "size": {
          "selector": "td:nth-child(4)"
        },
        "seeders": {
          "selector": "td:nth-child(6)"
        },
        "leechers": {
          "selector": "td:nth-child(7)"
        },
        "grabs": {
          "selector": "td:nth-child(8)"
        },
        "downloadvolumefactor": {
          "case": {
            "*": 0
          }
        },
        "uploadvolumefactor": {
          "case": {
            "*": 1
          }
        }
      }
    }
  }
  ```

  ç¤ºä¾‹äºŒï¼š
  ```json
  {
      "id": "xxx",
      "name": "ç«™ç‚¹åç§°",
      "domain": "https://www.xxx.com/",
      "ext_domains": [
        "https://www.xxx1.com/",
        "https://www.xxx2.com/"
      ],
      "encoding": "UTF-8",
      "public": false,
      "search": {
        "paths": [
          {
            "path": "torrents.php",
            "method": "get"
          }
        ],
        "params": {
          "search": "{keyword}",
          "search_area": 4
        },
        "batch": {
          "delimiter": " ",
          "space_replace": "_"
        }
      },
      "category": {
        "movie": [
          {
            "id": 401,
            "cat": "Movies",
            "desc": "Moviesç”µå½±"
          },
          {
            "id": 405,
            "cat": "Anime",
            "desc": "AnimationsåŠ¨æ¼«"
          },
          {
            "id": 404,
            "cat": "Documentary",
            "desc": "Documentariesçºªå½•ç‰‡"
          }
        ],
        "tv": [
          {
            "id": 402,
            "cat": "TV",
            "desc": "TV Seriesç”µè§†å‰§"
          },
          {
            "id": 403,
            "cat": "TV",
            "desc": "TV Showsç»¼è‰º"
          },
          {
            "id": 404,
            "cat": "Documentary",
            "desc": "Documentariesçºªå½•ç‰‡"
          },
          {
            "id": 405,
            "cat": "Anime",
            "desc": "AnimationsåŠ¨æ¼«"
          }
        ]
      },
      "torrents": {
        "list": {
          "selector": "table.torrents > tr:has(\"table.torrentname\")"
        },
        "fields": {
          "id": {
            "selector": "a[href*=\"details.php?id=\"]",
            "attribute": "href",
            "filters": [
              {
                "name": "re_search",
                "args": [
                  "\\d+",
                  0
                ]
              }
            ]
          },
          "title_default": {
            "selector": "a[href*=\"details.php?id=\"]"
          },
          "title_optional": {
            "optional": true,
            "selector": "a[title][href*=\"details.php?id=\"]",
            "attribute": "title"
          },
          "title": {
            "text": "{% if fields['title_optional'] %}{{ fields['title_optional'] }}{% else %}{{ fields['title_default'] }}{% endif %}"
          },
          "details": {
            "selector": "a[href*=\"details.php?id=\"]",
            "attribute": "href"
          },
          "download": {
            "selector": "a[href*=\"download.php?id=\"]",
            "attribute": "href"
          },
          "imdbid": {
            "selector": "div.imdb_100 > a",
            "attribute": "href",
            "filters": [
              {
                "name": "re_search",
                "args": [
                  "tt\\d+",
                  0
                ]
              }
            ]
          },
          "date_elapsed": {
            "selector": "td:nth-child(4) > span",
            "optional": true
          },
          "date_added": {
            "selector": "td:nth-child(4) > span",
            "attribute": "title",
            "optional": true
          },
          "size": {
            "selector": "td:nth-child(5)"
          },
          "seeders": {
            "selector": "td:nth-child(6)"
          },
          "leechers": {
            "selector": "td:nth-child(7)"
          },
          "grabs": {
            "selector": "td:nth-child(8)"
          },
          "downloadvolumefactor": {
            "case": {
              "img.pro_free": 0,
              "img.pro_free2up": 0,
              "img.pro_50pctdown": 0.5,
              "img.pro_50pctdown2up": 0.5,
              "img.pro_30pctdown": 0.3,
              "*": 1
            }
          },
          "uploadvolumefactor": {
            "case": {
              "img.pro_50pctdown2up": 2,
              "img.pro_free2up": 2,
              "img.pro_2up": 2,
              "*": 1
            }
          },
          "description": {
            "selector": "td:nth-child(2) > table > tr > td.embedded > span[style]",
            "contents": -1
          },
          "labels": {
            "selector": "td:nth-child(2) > table > tr > td.embedded > span.tags"
          }
        }
      }
    }
  ```
- éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½ æ²¡æœ‰å®Œæˆç”¨æˆ·è®¤è¯ï¼Œé€šè¿‡æ’ä»¶é…ç½®è¿›å»çš„ç´¢å¼•ç«™ç‚¹ä¹Ÿæ˜¯æ— æ³•æ­£å¸¸ä½¿ç”¨çš„ã€‚
- **è¯·ä¸è¦æ·»åŠ å¯¹é»„èµŒæ¯’ç«™ç‚¹çš„æ”¯æŒï¼Œå¦åˆ™éšæ—¶å°é—­æ¥å£ã€‚** 

### 7. å¦‚ä½•åœ¨æ’ä»¶ä¸­è°ƒç”¨APIæ¥å£ï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v1.8.4+` ç‰ˆæœ¬ï¼‰**
- åœ¨æ’ä»¶çš„æ•°æ®é¡µé¢æ”¯æŒ`GET/POST`APIæ¥å£è°ƒç”¨ï¼Œå¯è°ƒç”¨æ’ä»¶è‡ªèº«ã€ä¸»ç¨‹åºæˆ–å…¶å®ƒæ’ä»¶çš„APIã€‚
- åœ¨`get_page`ä¸­å®šä¹‰å¥½å…ƒç´ çš„äº‹ä»¶ï¼Œä»¥åŠç›¸åº”çš„APIå‚æ•°ï¼Œå…·ä½“å¯å‚è€ƒæ’ä»¶`è±†ç“£æƒ³çœ‹`ï¼š
```json
{
  "component": "VDialogCloseBtn", // è§¦å‘äº‹ä»¶çš„å…ƒç´ 
  "events": {
    "click": { // ç‚¹å‡»äº‹ä»¶
      "api": "plugin/DoubanSync/delete_history", // APIçš„ç›¸å¯¹è·¯å¾„
      "method": "get", // GET/POST
      "params": {
        // APIä¸Šé€å‚æ•°
        "doubanid": ""
      }
    }
  }
}
```
- æ¯æ¬¡APIè°ƒç”¨å®Œæˆåï¼Œå‡ä¼šè‡ªåŠ¨åˆ·æ–°ä¸€æ¬¡æ’ä»¶æ•°æ®é¡µã€‚

### 8. å¦‚ä½•å°†æ’ä»¶å†…å®¹æ˜¾ç¤ºåˆ°ä»ªè¡¨æ¿ï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v1.8.7+` ç‰ˆæœ¬ï¼‰**
- å°†æ’ä»¶çš„å†…å®¹æ˜¾ç¤ºåˆ°ä»ªè¡¨ç›˜ï¼Œå¹¶æ”¯æŒå®šä¹‰å æ®çš„å•å…ƒæ ¼å¤§å°ï¼Œæ’ä»¶äº§ç”Ÿçš„ä»ªè¡¨æ¿ä»…ç®¡ç†å‘˜å¯è§ã€‚
- 1. æ ¹æ®æ’ä»¶éœ€è¦å±•ç¤ºçš„Widgetå†…å®¹è§„åˆ’å±•ç¤ºå†…å®¹çš„æ ·å¼å’Œè§„æ ¼ï¼Œä¹Ÿå¯è®¾è®¡å¤šä¸ªè§„æ ¼æ ·å¼å¹¶æä¾›é…ç½®é¡¹ä¾›ç”¨æˆ·é€‰æ‹©ã€‚
- 2. å®ç° `get_dashboard_meta` æ–¹æ³•ï¼Œå®šä¹‰ä»ªè¡¨æ¿keyåŠåç§°ï¼Œæ”¯æŒä¸€ä¸ªæ’ä»¶æœ‰å¤šä¸ªä»ªè¡¨æ¿ï¼š
```python
def get_dashboard_meta(self) -> Optional[List[Dict[str, str]]]:
    """
    è·å–æ’ä»¶ä»ªè¡¨ç›˜å…ƒä¿¡æ¯
    è¿”å›ç¤ºä¾‹ï¼š
        [{
            "key": "dashboard1", // ä»ªè¡¨ç›˜çš„keyï¼Œåœ¨å½“å‰æ’ä»¶èŒƒå›´å”¯ä¸€
            "name": "ä»ªè¡¨ç›˜1" // ä»ªè¡¨ç›˜çš„åç§°
        }, {
            "key": "dashboard2",
            "name": "ä»ªè¡¨ç›˜2"
        }]
    """
    pass
```
- 3. å®ç° `get_dashboard` æ–¹æ³•ï¼Œæ ¹æ®keyè¿”å›ä»ªè¡¨ç›˜çš„è¯¦ç»†é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ä»ªè¡¨ç›˜çš„colsåˆ—é…ç½®ï¼ˆé€‚é…ä¸åŒå±å¹•ï¼‰ï¼Œä»¥åŠä»ªè¡¨ç›˜çš„é¡µé¢é…ç½®jsonï¼Œå…·ä½“å¯å‚è€ƒæ’ä»¶`ç«™ç‚¹æ•°æ®ç»Ÿè®¡`ï¼š
```python
def get_dashboard(self, key: str, **kwargs) -> Optional[Tuple[Dict[str, Any], Dict[str, Any], List[dict]]]:
    """
    è·å–æ’ä»¶ä»ªè¡¨ç›˜é¡µé¢ï¼Œéœ€è¦è¿”å›ï¼š1ã€ä»ªè¡¨æ¿colé…ç½®å­—å…¸ï¼›2ã€å…¨å±€é…ç½®ï¼ˆè‡ªåŠ¨åˆ·æ–°ç­‰ï¼‰ï¼›3ã€ä»ªè¡¨æ¿é¡µé¢å…ƒç´ é…ç½®jsonï¼ˆå«æ•°æ®ï¼‰
    1ã€colé…ç½®å‚è€ƒï¼š
    {
        "cols": 12, "md": 6
    }
    2ã€å…¨å±€é…ç½®å‚è€ƒï¼š
    {
        "refresh": 10, // è‡ªåŠ¨åˆ·æ–°æ—¶é—´ï¼Œå•ä½ç§’
        "border": True, // æ˜¯å¦æ˜¾ç¤ºè¾¹æ¡†ï¼Œé»˜è®¤Trueï¼Œä¸ºFalseæ—¶å–æ¶ˆç»„ä»¶è¾¹æ¡†å’Œè¾¹è·ï¼Œç”±æ’ä»¶è‡ªè¡Œæ§åˆ¶
        "title": "ç»„ä»¶æ ‡é¢˜", // ç»„ä»¶æ ‡é¢˜ï¼Œå¦‚æœ‰å°†æ˜¾ç¤ºè¯¥æ ‡é¢˜ï¼Œå¦åˆ™æ˜¾ç¤ºæ’ä»¶åç§°
        "subtitle": "ç»„ä»¶å­æ ‡é¢˜", // ç»„ä»¶å­æ ‡é¢˜ï¼Œç¼ºçœæ—¶ä¸å±•ç¤ºå­æ ‡é¢˜
    }
    3ã€é¡µé¢é…ç½®ä½¿ç”¨Vuetifyç»„ä»¶æ‹¼è£…ï¼Œå‚è€ƒï¼šhttps://vuetifyjs.com/

    kwargså‚æ•°å¯è·å–çš„å€¼ï¼š1ã€user_agentï¼šæµè§ˆå™¨UA

    :param key: ä»ªè¡¨ç›˜keyï¼Œæ ¹æ®æŒ‡å®šçš„keyè¿”å›ç›¸åº”çš„ä»ªè¡¨ç›˜æ•°æ®ï¼Œç¼ºçœæ—¶è¿”å›ä¸€ä¸ªå›ºå®šçš„ä»ªè¡¨ç›˜æ•°æ®ï¼ˆå…¼å®¹æ—§ç‰ˆï¼‰
    """
    pass
```

### 9. å¦‚ä½•æ‰©å±•æ¢ç´¢åŠŸèƒ½çš„åª’ä½“æ•°æ®æºï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v2.2.7+` ç‰ˆæœ¬ï¼‰**
- æ¢ç´¢åŠŸèƒ½ä»…å†…ç½®`TheMovieDb`ã€`è±†ç“£`å’Œ`Bangumi`æ•°æ®æºï¼Œå¯é€šè¿‡æ’ä»¶æ‰©å±•æ¢ç´¢åŠŸèƒ½çš„æ•°æ®æºèŒƒå›´ï¼ŒæŒ‰ä»¥ä¸‹æ–¹æ³•å¼€å‘æ’ä»¶ï¼ˆå‚è€ƒ`TheTVDBæ¢ç´¢`æ’ä»¶ï¼‰ï¼š
- 1. å®ç°`ChainEventType.DiscoverSource`é“¾å¼äº‹ä»¶å“åº”ï¼Œå°†é¢å¤–çš„åª’ä½“æ•°æ®æºå¡å…¥äº‹ä»¶æ•°æ®`extra_sources`æ•°ç»„ä¸­ï¼ˆæ³¨æ„ï¼šå¦‚æœäº‹ä»¶ä¸­å·²ç»æœ‰å…¶å®ƒæ•°æ®æºï¼Œéœ€è¦å åŠ è€Œä¸æ˜¯æ›¿æ¢ï¼Œé¿å…å½±å“å…¶å®ƒæ’ä»¶å¡å…¥çš„æ•°æ®ï¼‰
  
  - `name`ï¼šæ•°æ®æºåç§°
  - `mediaid_prefix`ï¼šæ•°æ®æºçš„å”¯ä¸€ID
  - `api_path`ï¼šæ•°æ®è·å–APIç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦åœ¨æ’ä»¶ä¸­å®ç°APIæ¥å£åŠŸèƒ½ï¼ŒGETæ¨¡å¼æ¥æ”¶è¿‡æ»¤å‚æ•°ï¼ˆæ³¨æ„ï¼špageå‚æ•°é»˜è®¤éœ€è¦æœ‰ï¼‰ï¼Œè¿”å›`List[schemas.MediaInfo])`æ ¼å¼æ•°æ®ï¼ˆæ³¨æ„ï¼šmediaid_prefixå’Œmedia_idéœ€è¦èµ‹å€¼ï¼Œç”¨äºå”¯ä¸€ç´¢å¼•åª’ä½“è¯¦ç»†ä¿¡æ¯å’Œè½¬æ¢åª’ä½“æ•°æ®ï¼‰ã€‚
  - `filter_params`ï¼šæ•°æ®æºè¿‡æ»¤å‚æ•°åçš„å­—å…¸ï¼Œç›¸å…³å‚æ•°ä¼šä¼ å…¥æ’ä»¶APIçš„GETè¯·æ±‚ä¸­
  - `filter_ui`ï¼šæ•°æ®è¿‡æ»¤é€‰é¡¹çš„UIé…ç½®jsonï¼Œä¸æ’ä»¶é…ç½®è¡¨å•æ–¹å¼ä¸€è‡´
  - `depends`: UIä¾èµ–å…³ç³»å­—å…¸Dict[str, list]ï¼Œå…³è¿‡æ»¤æ¡ä»¶å­˜åœ¨ä¾èµ–å…³ç³»æ—¶éœ€è¦è®¾ç½®ï¼Œä»¥ä¾¿ä¸Šçº§æ¡ä»¶å˜åŒ–æ—¶æ¸…ç©ºä¸‹çº§æ¡ä»¶å€¼

```python
class DiscoverMediaSource(BaseModel):
    """
    æ¢ç´¢åª’ä½“æ•°æ®æºçš„åŸºç±»
    """
    name: str = Field(..., description="æ•°æ®æºåç§°")
    mediaid_prefix: str = Field(..., description="åª’ä½“IDçš„å‰ç¼€ï¼Œä¸å«:")
    api_path: str = Field(..., description="åª’ä½“æ•°æ®æºAPIåœ°å€")
    filter_params: Optional[Dict[str, Any]] = Field(default=None, description="è¿‡æ»¤å‚æ•°")
    filter_ui: Optional[List[dict]] = Field(default=[], description="è¿‡æ»¤å‚æ•°UIé…ç½®")

class DiscoverSourceEventData(ChainEventData):
    """
    DiscoverSource äº‹ä»¶çš„æ•°æ®æ¨¡å‹
    Attributes:
        # è¾“å‡ºå‚æ•°
        extra_sources (List[DiscoverMediaSource]): é¢å¤–åª’ä½“æ•°æ®æº
    """
    # è¾“å‡ºå‚æ•°
    extra_sources: List[DiscoverMediaSource] = Field(default_factory=list, description="é¢å¤–åª’ä½“æ•°æ®æº")
```

- 2. å®ç°`ChainEventType.MediaRecognizeConvert`é“¾å¼äº‹ä»¶å“åº”ï¼ˆ**å¯é€‰**ï¼Œå¦‚ä¸å®ç°åˆ™é»˜è®¤æŒ‰æ ‡é¢˜é‡æ–°è¯†åˆ«åª’ä½“ä¿¡æ¯ï¼‰ï¼Œæ ¹æ®åª’ä½“IDå’Œè½¬æ¢ç±»å‹ï¼Œè¿”å›TheMovieDbæˆ–è±†ç“£çš„åª’ä½“æ•°æ®ï¼Œå°†è½¬æ¢åçš„æ•°æ®æ³¨å…¥äº‹ä»¶æ•°æ®`media_dict`ä¸­ï¼Œå¯å‚è€ƒ`app/chain/media.py`ä¸­çš„`get_tmdbinfo_by_bangumiid`ã€‚

  - `mediaid`ï¼šåª’ä½“IDï¼Œæ ¼å¼ä¸º`mediaid_prefix:media_id`ï¼Œå¦‚ tmdb:12345ã€douban:1234567
  - `convert_type`ï¼šè½¬æ¢ç±»å‹ï¼Œä»…æ”¯æŒï¼šthemoviedb/doubanï¼Œéœ€è¦è½¬æ¢ä¸ºå¯¹åº”çš„åª’ä½“æ•°æ®å¹¶è¿”å›
  - `media_dict`ï¼šè½¬æ¢åçš„åª’ä½“æ•°æ®ï¼Œæ ¼å¼ä¸º`TheMovieDb/è±†ç“£`çš„åª’ä½“æ•°æ®

```python
class MediaRecognizeConvertEventData(ChainEventData):
    """
    MediaRecognizeConvert äº‹ä»¶çš„æ•°æ®æ¨¡å‹
    Attributes:
        # è¾“å…¥å‚æ•°
        mediaid (str): åª’ä½“IDï¼Œæ ¼å¼ä¸º`å‰ç¼€:IDå€¼`ï¼Œå¦‚ tmdb:12345ã€douban:1234567
        convert_type (str): è½¬æ¢ç±»å‹ ä»…æ”¯æŒï¼šthemoviedb/doubanï¼Œéœ€è¦è½¬æ¢ä¸ºå¯¹åº”çš„åª’ä½“æ•°æ®å¹¶è¿”å›
        # è¾“å‡ºå‚æ•°
        media_dict (dict): TheMovieDb/è±†ç“£çš„åª’ä½“æ•°æ®
    """
    # è¾“å…¥å‚æ•°
    mediaid: str = Field(..., description="åª’ä½“ID")
    convert_type: str = Field(..., description="è½¬æ¢ç±»å‹ï¼ˆthemoviedb/doubanï¼‰")
    # è¾“å‡ºå‚æ•°
    media_dict: dict = Field(default=dict, description="è½¬æ¢åçš„åª’ä½“ä¿¡æ¯ï¼ˆTheMovieDb/è±†ç“£ï¼‰")
```
- 3. å¯ç”¨æ’ä»¶åï¼Œç‚¹å‡»æ¢ç´¢åŠŸèƒ½å°†è‡ªåŠ¨ç”Ÿæˆé¢å¤–çš„æ•°æ®æºæ ‡ç­¾åŠé¡µé¢ï¼Œé¡µé¢ä¸­é€‰æ‹©ä¸åŒçš„è¿‡æ»¤æ¡ä»¶æ—¶ä¼šé‡æ–°è§¦å‘APIè¯·æ±‚ã€‚

### 10. å¦‚ä½•æ‰©å±•æ¨èåŠŸèƒ½çš„åª’ä½“æ•°æ®æºï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v2.2.8+` ç‰ˆæœ¬ï¼‰**
- å®ç°`ChainEventType.RecommendSource`é“¾å¼äº‹ä»¶å“åº”ï¼Œå°†é¢å¤–çš„åª’ä½“æ•°æ®æºå¡å…¥äº‹ä»¶æ•°æ®`extra_sources`æ•°ç»„ä¸­ï¼ˆæ³¨æ„ï¼šå¦‚æœäº‹ä»¶ä¸­å·²ç»æœ‰å…¶å®ƒæ•°æ®æºï¼Œéœ€è¦å åŠ è€Œä¸æ˜¯æ›¿æ¢ï¼Œé¿å…å½±å“å…¶å®ƒæ’ä»¶å¡å…¥çš„æ•°æ®ï¼‰

  - `name`ï¼šæ•°æ®æºåç§°
  - `api_path`ï¼šæ•°æ®è·å–APIç›¸å¯¹è·¯å¾„ï¼Œéœ€è¦åœ¨æ’ä»¶ä¸­å®ç°APIæ¥å£åŠŸèƒ½ï¼ŒGETæ¨¡å¼æ¥æ”¶è¿‡æ»¤å‚æ•°ï¼ˆæ³¨æ„ï¼špageå‚æ•°é»˜è®¤éœ€è¦æœ‰ï¼‰ï¼Œè¿”å›`List[schemas.MediaInfo])`æ ¼å¼æ•°æ®ï¼Œå‚è€ƒ`app/api/endpoints/recommend.py` ä¸­çš„ `tmdb_trending`ã€‚

```python
class RecommendMediaSource(BaseModel):
    """
    æ¨èåª’ä½“æ•°æ®æºçš„åŸºç±»
    """
    name: str = Field(..., description="æ•°æ®æºåç§°")
    api_path: str = Field(..., description="åª’ä½“æ•°æ®æºAPIåœ°å€")

class RecommendSourceEventData(ChainEventData):
    """
    RecommendSource äº‹ä»¶çš„æ•°æ®æ¨¡å‹
    Attributes:
        # è¾“å‡ºå‚æ•°
        extra_sources (List[RecommendMediaSource]): é¢å¤–åª’ä½“æ•°æ®æº
    """
    # è¾“å‡ºå‚æ•°
    extra_sources: List[RecommendMediaSource] = Field(default_factory=list, description="é¢å¤–åª’ä½“æ•°æ®æº")
```

### 11. å¦‚ä½•é€šè¿‡æ’ä»¶é‡è½½å®ç°ç³»ç»Ÿæ¨¡å—åŠŸèƒ½ï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v2.4.4+` ç‰ˆæœ¬ï¼‰**
- MoviePilotä¸­é€šè¿‡`chain`å±‚å®ç°ä¸šåŠ¡é€»è¾‘ï¼Œåœ¨`modules`ä¸­å®ç°å„è‡ªç‹¬ç«‹çš„åŠŸèƒ½æ¨¡å—ã€‚`chain`å¤„ç†é“¾é€šè¿‡æŸ¥æ‰¾`modules`ä¸­å®ç°äº†æ‰€éœ€æ–¹æ³•ï¼ˆæ¯”å¦‚: post_messageï¼‰çš„æ‰€æœ‰æ¨¡å—å¹¶æŒ‰ä¸€å®šçš„è§„åˆ™æ‰§è¡Œï¼Œä»è€Œç¼–æ’å„æ¨¡å—èƒ½åŠ›æ¥å®ç°å¤æ‚çš„ä¸šåŠ¡åŠŸèƒ½ã€‚v2.4.4+ç‰ˆæœ¬ä¸­èµ‹äºæ’ä»¶èƒæŒç³»ç»Ÿæ¨¡å—çš„èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æ¥é‡æ–°å®ç°ç³»ç»Ÿæ‰€æœ‰å†…ç½®æ¨¡å—çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ”¯æŒæ–°çš„ä¸‹è½½å™¨ã€åª’ä½“æœåŠ¡å™¨ç­‰ï¼ˆåœ¨ç”¨æˆ·ç•Œé¢ä¸­é…åˆæ–°å¢è‡ªå®šä¹‰ä¸‹è½½å™¨å’Œåª’ä½“æœåŠ¡å™¨ï¼‰ã€‚
- 1. åœ¨æ’ä»¶ä¸­å®ç°`get_module`æ–¹æ³•ï¼Œç”³æ˜æ’ä»¶è¦é‡è½½çš„æ¨¡å—æ–¹æ³•ã€‚æ‰€æœ‰å¯ç”¨çš„æ¨¡å—æ–¹æ³•åå‚è€ƒ`chain`ç›®å½•ä¸‹çš„å¤„ç†é“¾æ–‡ä»¶ï¼ˆrun_moduleæ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼‰ï¼Œå…¬å…±å¤„ç†åœ¨`chain/__init__.py`ä¸­ï¼Œæ–¹æ³•å…¥å‚å’Œå‡ºå‚éœ€è¦ä¿æŒä¸€è‡´ã€‚
```python
def get_module(self) -> Dict[str, Any]:
    """
    è·å–æ’ä»¶æ¨¡å—å£°æ˜ï¼Œç”¨äºèƒæŒç³»ç»Ÿæ¨¡å—å®ç°ï¼ˆæ–¹æ³•åï¼šæ–¹æ³•å®ç°ï¼‰
    {
        "id1": self.xxx1,
        "id2": self.xxx2,
    }
    """
    pass
```
- 2. åœ¨æ’ä»¶ä¸­å®ç°å£°åçš„æ–¹æ³•é€»è¾‘ï¼Œå¤„ç†é“¾æ‰§è¡Œæ—¶ï¼Œä¼šä¼˜å…ˆå¤„ç†æ’ä»¶å£°æ˜çš„æ–¹æ³•ã€‚å¦‚æœæ’ä»¶æ–¹æ³•æœªå®ç°æˆ–è€…è¿”å›`None`ï¼Œå°†ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªæ’ä»¶æˆ–è€…ç³»ç»Ÿæ¨¡å—çš„ç›¸åŒå£°æ˜æ–¹æ³•ï¼›å¦‚æœå¯¹åº”çš„æ–¹æ³•éœ€è¦è¿”å›æ˜¯çš„åˆ—è¡¨å¯¹è±¡ï¼Œåˆ™ä¼šæ‰§è¡Œæ‰€æœ‰æ’ä»¶å’Œç³»ç»Ÿæ¨¡å—çš„æ–¹æ³•åå°†ç»“æœç»„åˆè¿”å›ã€‚

### 12. å¦‚ä½•é€šè¿‡æ’ä»¶æ‰©å±•æ”¯æŒçš„å­˜å‚¨ç±»å‹ï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v2.4.4+` ç‰ˆæœ¬ï¼‰**
- 1. ç”¨æˆ·åœ¨ç³»ç»Ÿè®¾å®šå­˜å‚¨ä¸­æ–°å¢è‡ªå®šä¹‰å­˜å‚¨ï¼Œå¹¶è®¾å®šä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å’Œåç§°ï¼Œè¯¥ç±»å‹ä¸æ’ä»¶ç»‘å®šï¼Œç”¨äºæ’ä»¶åˆ¤æ–­ä½¿ç”¨ã€‚æˆ–è€…åœ¨æ’ä»¶å¯åŠ¨æ—¶ç›´æ¥æ³¨å†Œè‡ªå®šä¹‰å­˜å‚¨ã€‚
```python
# æ£€æŸ¥æ˜¯å¦æœ‰xxxç½‘ç›˜é€‰é¡¹ï¼Œå¦‚æ²¡æœ‰åˆ™è‡ªåŠ¨æ·»åŠ 
storage_helper = StorageHelper()
storages = StorageHelper().get_storagies()
if not any(s.type == "xxx" for s in storages):
    # æ·»åŠ å­˜å‚¨é…ç½®
    storage_helper.add_storage("xxx", name="xxxç½‘ç›˜", conf={})
```
- 2. åœ¨æ’ä»¶çš„å­˜å‚¨æ“ä½œç±»ä¸­ï¼Œå®ç°ä»¥ä¸‹å¯¹åº”çš„æ–‡ä»¶æ“ä½œï¼ˆå…·ä½“å¯å‚è€ƒï¼šapp/modules/filemanager/storages/\__init__.pyï¼‰ï¼Œä¸æ”¯æŒçš„å¯è·³è¿‡
```python
class XxxApi:

    def list(self, fileitem: schemas.FileItem) -> List[schemas.FileItem]:
        """
        æµè§ˆæ–‡ä»¶
        """
        pass

    def create_folder(self, fileitem: schemas.FileItem, name: str) -> Optional[schemas.FileItem]:
        """
        åˆ›å»ºç›®å½•
        :param fileitem: çˆ¶ç›®å½•
        :param name: ç›®å½•å
        """
        pass

    def get_folder(self, path: Path) -> Optional[schemas.FileItem]:
        """
        è·å–ç›®å½•ï¼Œå¦‚ç›®å½•ä¸å­˜åœ¨åˆ™åˆ›å»º
        """
        pass

    def get_item(self, path: Path) -> Optional[schemas.FileItem]:
        """
        è·å–æ–‡ä»¶æˆ–ç›®å½•ï¼Œä¸å­˜åœ¨è¿”å›None
        """
        pass

    def get_parent(self, fileitem: schemas.FileItem) -> Optional[schemas.FileItem]:
        """
        è·å–çˆ¶ç›®å½•
        """
        return self.get_item(Path(fileitem.path).parent)

    def delete(self, fileitem: schemas.FileItem) -> bool:
        """
        åˆ é™¤æ–‡ä»¶
        """
        pass

    def rename(self, fileitem: schemas.FileItem, name: str) -> bool:
        """
        é‡å‘½åæ–‡ä»¶
        """
        pass

    def download(self, fileitem: schemas.FileItem, path: Path = None) -> Path:
        """
        ä¸‹è½½æ–‡ä»¶ï¼Œä¿å­˜åˆ°æœ¬åœ°ï¼Œè¿”å›æœ¬åœ°ä¸´æ—¶æ–‡ä»¶åœ°å€
        :param fileitem: æ–‡ä»¶é¡¹
        :param path: æ–‡ä»¶ä¿å­˜è·¯å¾„
        """
        pass

    def upload(self, fileitem: schemas.FileItem, path: Path, new_name: Optional[str] = None) -> Optional[schemas.FileItem]:
        """
        ä¸Šä¼ æ–‡ä»¶
        :param fileitem: ä¸Šä¼ ç›®å½•é¡¹
        :param path: æœ¬åœ°æ–‡ä»¶è·¯å¾„
        :param new_name: ä¸Šä¼ åæ–‡ä»¶å
        """
        pass

    def detail(self, fileitem: schemas.FileItem) -> Optional[schemas.FileItem]:
        """
        è·å–æ–‡ä»¶è¯¦æƒ…
        """
        pass

    def copy(self, fileitem: schemas.FileItem, path: Path, new_name: str) -> bool:
        """
        å¤åˆ¶æ–‡ä»¶
        :param fileitem: æ–‡ä»¶é¡¹
        :param path: ç›®æ ‡ç›®å½•
        :param new_name: æ–°æ–‡ä»¶å
        """
        pass

    def move(self, fileitem: schemas.FileItem, path: Path, new_name: str) -> bool:
        """
        ç§»åŠ¨æ–‡ä»¶
        :param fileitem: æ–‡ä»¶é¡¹
        :param path: ç›®æ ‡ç›®å½•
        :param new_name: æ–°æ–‡ä»¶å
        """
        pass

    def link(self, fileitem: schemas.FileItem, target_file: Path) -> bool:
        """
        ç¡¬é“¾æ¥æ–‡ä»¶
        """
        pass

    def softlink(self, fileitem: schemas.FileItem, target_file: Path) -> bool:
        """
        è½¯é“¾æ¥æ–‡ä»¶
        """
        pass

    def usage(self) -> Optional[schemas.StorageUsage]:
        """
        å­˜å‚¨ä½¿ç”¨æƒ…å†µ
        """
        pass
```
- 3. å®ç° `ChainEventType.StorageOperSelection`é“¾å¼äº‹ä»¶å“åº”ï¼Œæ ¹æ®ä¼ å…¥çš„å­˜å‚¨å¯¹è±¡åç§°åˆ¤æ–­æ˜¯å¦ä¸ºè¯¥æ’ä»¶æ”¯æŒçš„å­˜å‚¨ï¼Œå¦‚æ˜¯åˆ™è¿”å›å­˜å‚¨æ“ä½œå¯¹è±¡
```python
@eventmanager.register(ChainEventType.StorageOperSelection)
def storage_oper_selection(self, event: Event):
    """
    ç›‘å¬å­˜å‚¨é€‰æ‹©äº‹ä»¶ï¼Œè¿”å›å½“å‰ç±»ä¸ºæ“ä½œå¯¹è±¡
    """
    if not self._enabled:
        return
    event_data: StorageOperSelectionEventData = event.event_data
    if event_data.storage == "xxx":
        event_data.storage_oper = self.api # apiä¸ºæ’ä»¶çš„å­˜å‚¨æ“ä½œå¯¹è±¡
```

- 4. å‚è€ƒ 11 å®ç°`get_module`åœ¨æ’ä»¶ä¸­å£°æ˜å’Œå®ç°ä»¥ä¸‹æ¨¡å—æ–¹æ³•ï¼ˆå…·ä½“å¯å‚è€ƒï¼šapp/modules/filemanager/\__init__.pyï¼‰ï¼Œå…¶å®å°±æ˜¯å¯¹ä¸Šä¸€æ­¥çš„æ–¹æ³•å†åšä¸€ä¸‹å°è£…ï¼š
```python
def get_module(self) -> Dict[str, Any]:
    """
    è·å–æ’ä»¶æ¨¡å—å£°æ˜ï¼Œç”¨äºèƒæŒç³»ç»Ÿæ¨¡å—å®ç°ï¼ˆæ–¹æ³•åï¼šæ–¹æ³•å®ç°ï¼‰
    {
        "id1": self.xxx1,
        "id2": self.xxx2,
    }
    """
    return {
        "list_files": self.list_files,
        "any_files": self.any_files,
        "download_file": self.download_file,
        "upload_file": self.upload_file,
        "delete_file": self.delete_file,
        "rename_file": self.rename_file,
        "get_file_item": self.get_file_item,
        "get_parent_item": self.get_parent_item,
        "snapshot_storage": self.snapshot_storage,
        "storage_usage": self.storage_usage,
        "support_transtype": self.support_transtype
    }

def list_files(self, fileitem: schemas.FileItem, recursion: bool = False) -> Optional[List[schemas.FileItem]]:
    """
    æŸ¥è¯¢å½“å‰ç›®å½•ä¸‹æ‰€æœ‰ç›®å½•å’Œæ–‡ä»¶
    """
    
    if fileitem.storage != "xxx":
        return None

    def __get_files(_item: FileItem, _r: Optional[bool] = False):
        """
        é€’å½’å¤„ç†
        """
        _items = self.api.list(_item)
        if _items:
            if _r:
                for t in _items:
                    if t.type == "dir":
                        __get_files(t, _r)
                    else:
                        result.append(t)
            else:
                result.extend(_items)

    # è¿”å›ç»“æœ
    result = []
    __get_files(fileitem, recursion)

    return result

def any_files(self, fileitem: schemas.FileItem, extensions: list = None) -> Optional[bool]:
    """
    æŸ¥è¯¢å½“å‰ç›®å½•ä¸‹æ˜¯å¦å­˜åœ¨æŒ‡å®šæ‰©å±•åä»»æ„æ–‡ä»¶
    """
    if fileitem.storage != "xxx":
        return None
    
    def __any_file(_item: FileItem):
        """
        é€’å½’å¤„ç†
        """
        _items = self.api.list(_item)
        if _items:
            if not extensions:
                return True
            for t in _items:
                if (t.type == "file"
                        and t.extension
                        and f".{t.extension.lower()}" in extensions):
                    return True
                elif t.type == "dir":
                    if __any_file(t):
                        return True
        return False

    # è¿”å›ç»“æœ
    return __any_file(fileitem)

def download_file(self, fileitem: schemas.FileItem, path: Path = None) -> Optional[Path]:
    """
    ä¸‹è½½æ–‡ä»¶
    :param fileitem: æ–‡ä»¶é¡¹
    :param path: æœ¬åœ°ä¿å­˜è·¯å¾„
    """
    if fileitem.storage != "xxx":
        return None
    
    return self.api.download(fileitem, path)

def upload_file(self, fileitem: schemas.FileItem, path: Path,
                new_name: Optional[str] = None) -> Optional[schemas.FileItem]:
    """
    ä¸Šä¼ æ–‡ä»¶
    :param fileitem: ä¿å­˜ç›®å½•é¡¹
    :param path: æœ¬åœ°æ–‡ä»¶è·¯å¾„
    :param new_name: æ–°æ–‡ä»¶å
    """
    if fileitem.storage != "xxx":
        return None
    
    return self.api.upload(fileitem, path, new_name)

def delete_file(self, fileitem: schemas.FileItem) -> Optional[bool]:
    """
    åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•
    """
    if fileitem.storage != "xxx":
        return None
    
    return self.api.delete(fileitem)

def rename_file(self, fileitem: schemas.FileItem, name: str) -> Optional[bool]:
    """
    é‡å‘½åæ–‡ä»¶æˆ–ç›®å½•
    """
    if fileitem.storage != "xxx":
        return None
    
    return self.api.rename(fileitem, name)

def get_file_item(self, storage: str, path: Path) -> Optional[schemas.FileItem]:
    """
    æ ¹æ®è·¯å¾„è·å–æ–‡ä»¶é¡¹
    """
    if storage != "xxx":
        return None
    
    return self.api.get_item(path)

def get_parent_item(self, fileitem: schemas.FileItem) -> Optional[schemas.FileItem]:
    """
    è·å–ä¸Šçº§ç›®å½•é¡¹
    """
    if fileitem.storage != "xxx":
        return None
    
    return self.api.get_parent(fileitem)

def snapshot_storage(self, storage: str, path: Path) -> Optional[Dict[str, float]]:
    """
    å¿«ç…§å­˜å‚¨
    """
    if storage != "xxx":
        return None
    
    files_info = {}

    def __snapshot_file(_fileitm: schemas.FileItem):
        """
        é€’å½’è·å–æ–‡ä»¶ä¿¡æ¯
        """
        if _fileitm.type == "dir":
            for sub_file in self.api.list(_fileitm):
                __snapshot_file(sub_file)
        else:
            files_info[_fileitm.path] = _fileitm.size

    fileitem = self.api.get_item(path)
    if not fileitem:
        return {}

    __snapshot_file(fileitem)

    return files_info

def storage_usage(self, storage: str) -> Optional[schemas.StorageUsage]:
    """
    å­˜å‚¨ä½¿ç”¨æƒ…å†µ
    """
    return self.api.usage()

@staticmethod
def support_transtype(storage: str) -> Optional[dict]:
    """
    è·å–æ”¯æŒçš„æ•´ç†æ–¹å¼
    """
    return {
        "move": "ç§»åŠ¨",
        "copy": "å¤åˆ¶"
    }
```

### 13. å¦‚ä½•å°†æ’ä»¶åŠŸèƒ½é›†æˆåˆ°å·¥ä½œæµï¼Ÿ
**ï¼ˆä»…æ”¯æŒ v2.4.8+ ç‰ˆæœ¬ï¼‰**
- æ’ä»¶å®ç°ä»¥ä¸‹æ¥å£ï¼Œå£°æ˜æ’ä»¶æ”¯æŒçš„åŠ¨ä½œå®ç°
```python
def get_actions(self) -> List[Dict[str, Any]]:
    """
    è·å–æ’ä»¶å·¥ä½œæµåŠ¨ä½œ
    [{
        "id": "åŠ¨ä½œID",
        "name": "åŠ¨ä½œåç§°",
        "func": self.xxx,
        "kwargs": {} # éœ€è¦é™„åŠ ä¼ é€’çš„å‚æ•°
    }]

    å¯¹å®ç°å‡½æ•°çš„è¦æ±‚ï¼š
    1ã€å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å›ºå®šä¸º ActionContent å®ä¾‹ï¼Œå¦‚éœ€è¦ä¼ é€’é¢å¤–å‚æ•°ï¼Œåœ¨kwargsä¸­å®šä¹‰
    2ã€å‡½æ•°çš„è¿”å›ï¼šæ‰§è¡ŒçŠ¶æ€ True / Falseï¼Œæ›´æ–°åçš„ ActionContent å®ä¾‹
    """
    pass
```
- ç¼–è¾‘å·¥ä½œæµæµç¨‹ï¼Œæ·»åŠ `è°ƒç”¨æ’ä»¶`ç»„ä»¶ï¼Œé€‰æ‹©è¯¥æ’ä»¶çš„å¯¹åº”åŠ¨ä½œï¼Œå°†æ’ä»¶çš„åŠŸèƒ½ä¸²æ¥åˆ°å·¥ä½œæµç¨‹ä¸­

### 14. å¦‚ä½•åœ¨æ’ä»¶ä¸­é€šè¿‡æ¶ˆæ¯æŒç»­ä¸ç”¨æˆ·äº¤äº’ï¼Ÿ
**ï¼ˆä»…æ”¯æŒ v2.5.7+ ç‰ˆæœ¬ï¼‰**
- æ’ä»¶å¯ä»¥é€šè¿‡å®ç°å‘½ä»¤å“åº”å’Œæ¶ˆæ¯æŒ‰é’®å›è°ƒå®ç°ä¸ç”¨æˆ·çš„æŒç»­äº¤äº’å¯¹è¯ï¼Œæ”¯æŒå¤šè½®å¯¹è¯å’Œèœå•å¼æ“ä½œï¼Œé€‚ç”¨äºæ”¯æŒæŒ‰é’®å›è°ƒçš„é€šçŸ¥æ¸ é“ï¼ˆå¦‚Telegramã€Slackç­‰ï¼‰ã€‚

- 1. å®ç°è¿œç¨‹å‘½ä»¤å“åº”ï¼Œå‚è€ƒç¬¬2ä¸ªå¸¸è§é—®é¢˜å®ç° `get_command()` æ–¹æ³•å’Œ `PluginAction` äº‹ä»¶å“åº”ï¼š
    ```python
    def get_command(self) -> List[Dict[str, Any]]:
        """
        æ³¨å†Œæ’ä»¶è¿œç¨‹å‘½ä»¤
        """
        return [{
            "cmd": "/interactive_demo",
            "event": EventType.PluginAction,
            "desc": "äº¤äº’æ¼”ç¤º",
            "category": "æ’ä»¶äº¤äº’",
            "data": {
                "action": "interactive_demo"
            }
        }]

    @eventmanager.register(EventType.PluginAction)
    def command_action(self, event: Event):
        """
        è¿œç¨‹å‘½ä»¤å“åº”
        """
        event_data = event.event_data
        if not event_data or event_data.get("action") != "interactive_demo":
            return
        
        # è·å–ç”¨æˆ·ä¿¡æ¯
        channel = event_data.get("channel")
        source = event_data.get("source")
        user = event_data.get("user")
        
        # å‘é€å¸¦æœ‰äº¤äº’æŒ‰é’®çš„æ¶ˆæ¯
        self._send_main_menu(channel, source, user)
    ```

- 2. æ³¨å†Œ `MessageAction` äº‹ä»¶å“åº”ï¼Œå¤„ç†ç”¨æˆ·çš„æŒ‰é’®å›è°ƒï¼š
    ```python
    @eventmanager.register(EventType.MessageAction)
    def message_action(self, event: Event):
        """
        å¤„ç†æ¶ˆæ¯æŒ‰é’®å›è°ƒ
        """
        event_data = event.event_data
        if not event_data:
            return
            
        # æ£€æŸ¥æ˜¯å¦ä¸ºæœ¬æ’ä»¶çš„å›è°ƒ
        plugin_id = event_data.get("plugin_id")
        if plugin_id != self.__class__.__name__:
            return
            
        # è·å–å›è°ƒæ•°æ®
        text = event_data.get("text", "")
        channel = event_data.get("channel")
        source = event_data.get("source")
        userid = event_data.get("userid")
        # è·å–åŸå§‹æ¶ˆæ¯IDå’ŒèŠå¤©IDï¼ˆç”¨äºç›´æ¥æ›´æ–°åŸæ¶ˆæ¯ï¼‰
        original_message_id = event_data.get("original_message_id")
        original_chat_id = event_data.get("original_chat_id")
        
        # æ ¹æ®å›è°ƒå†…å®¹å¤„ç†ä¸åŒçš„äº¤äº’
        if text == "menu1":
            self._handle_menu1(channel, source, userid, original_message_id, original_chat_id)
        elif text == "menu2":
            self._handle_menu2(channel, source, userid, original_message_id, original_chat_id)
        elif text == "back":
            self._send_main_menu(channel, source, userid, original_message_id, original_chat_id)
        elif text.startswith("action_"):
            action_id = text.replace("action_", "")
            self._handle_action(action_id, channel, source, userid, original_message_id, original_chat_id)
    ```

- 3. å®ç°å…·ä½“çš„äº¤äº’å¤„ç†æ–¹æ³•ï¼Œåœ¨æ¶ˆæ¯ä¸­ä½¿ç”¨ `[PLUGIN]æ’ä»¶ID|å†…å®¹` æ ¼å¼çš„æŒ‰é’®ï¼š
    ```python
    def _send_main_menu(self, channel, source, userid, original_message_id=None, original_chat_id=None):
        """
        å‘é€ä¸»èœå•
        """
        buttons = [
            [
                {"text": "ğŸ¬ åª’ä½“ç®¡ç†", "callback_data": f"[PLUGIN]{self.__class__.__name__}|menu1"},
                {"text": "âš™ï¸ ç³»ç»Ÿè®¾ç½®", "callback_data": f"[PLUGIN]{self.__class__.__name__}|menu2"}
            ],
            [
                {"text": "ğŸ“Š æŸ¥çœ‹çŠ¶æ€", "callback_data": f"[PLUGIN]{self.__class__.__name__}|status"}
            ]
        ]
        
        self.post_message(
            channel=channel,
            title="ğŸ¤– æ’ä»¶äº¤äº’æ¼”ç¤º",
            text="è¯·é€‰æ‹©è¦æ‰§è¡Œçš„æ“ä½œï¼š",
            userid=userid,
            buttons=buttons,
            original_message_id=original_message_id,
            original_chat_id=original_chat_id
        )

    def _handle_menu1(self, channel, source, userid, original_message_id, original_chat_id):
        """
        å¤„ç†åª’ä½“ç®¡ç†èœå•
        """
        buttons = [
            [
                {"text": "ğŸ” æœç´¢åª’ä½“", "callback_data": f"[PLUGIN]{self.__class__.__name__}|action_search"},
                {"text": "ğŸ“¥ ä¸‹è½½ç®¡ç†", "callback_data": f"[PLUGIN]{self.__class__.__name__}|action_download"}
            ],
            [
                {"text": "ğŸ”™ è¿”å›ä¸»èœå•", "callback_data": f"[PLUGIN]{self.__class__.__name__}|back"}
            ]
        ]
        
        self.post_message(
            channel=channel,
            title="ğŸ¬ åª’ä½“ç®¡ç†",
            text="é€‰æ‹©åª’ä½“ç®¡ç†åŠŸèƒ½ï¼š",
            userid=userid,
            buttons=buttons,
            original_message_id=original_message_id,
            original_chat_id=original_chat_id
        )

    def _handle_action(self, action_id, channel, source, userid, original_message_id, original_chat_id):
        """
        å¤„ç†å…·ä½“åŠ¨ä½œ
        """
        if action_id == "search":
            # æ‰§è¡Œæœç´¢é€»è¾‘
            result = "æœç´¢åŠŸèƒ½å·²æ‰§è¡Œ"
        elif action_id == "download":
            # æ‰§è¡Œä¸‹è½½é€»è¾‘
            result = "ä¸‹è½½ç®¡ç†å·²å¼€å¯"
        else:
            result = "æœªçŸ¥æ“ä½œ"
            
        # å‘é€æ‰§è¡Œç»“æœå¹¶æä¾›è¿”å›æŒ‰é’®
        buttons = [
            [{"text": "ğŸ”™ è¿”å›ä¸»èœå•", "callback_data": f"[PLUGIN]{self.__class__.__name__}|back"}]
        ]
        
        self.post_message(
            channel=channel,
            title="âœ… æ“ä½œå®Œæˆ",
            text=result,
            userid=userid,
            buttons=buttons,
            original_message_id=original_message_id,
            original_chat_id=original_chat_id
        )
    ```

- æ³¨æ„äº‹é¡¹ï¼š
  - å›è°ƒæŒ‰é’®çš„ `callback_data` å¿…é¡»ä½¿ç”¨ `[PLUGIN]æ’ä»¶ID|å†…å®¹` æ ¼å¼ï¼Œå…¶ä¸­æ’ä»¶IDä¸ºæ’ä»¶ç±»å
  - åªæœ‰æ”¯æŒæŒ‰é’®å›è°ƒçš„é€šçŸ¥æ¸ é“ï¼ˆå¦‚Telegramã€Slackï¼‰æ‰èƒ½ä½¿ç”¨æ­¤åŠŸèƒ½
  - å»ºè®®åœ¨äº¤äº’ä¸­ä¿å­˜ç”¨æˆ·çŠ¶æ€æ•°æ®ï¼Œä»¥æ”¯æŒå¤æ‚çš„å¤šæ­¥éª¤æ“ä½œ
  - å¯ä»¥ç»“åˆæ’ä»¶æ•°æ®å­˜å‚¨åŠŸèƒ½ä¿å­˜ç”¨æˆ·çš„äº¤äº’å†å²å’Œåå¥½è®¾ç½®

### 15. å¦‚ä½•åœ¨æ’ä»¶ä¸­ä½¿ç”¨ç³»ç»Ÿçº§ç»Ÿä¸€ç¼“å­˜ï¼Ÿ
**ï¼ˆä»…æ”¯æŒ `v2.7.4+` ç‰ˆæœ¬ï¼‰**
- MoviePilotæä¾›äº†ç»Ÿä¸€çš„ç¼“å­˜ç³»ç»Ÿï¼Œæ”¯æŒå†…å­˜ç¼“å­˜ã€æ–‡ä»¶ç³»ç»Ÿç¼“å­˜å’ŒRedisç¼“å­˜è‡ªåŠ¨ç®¡ç†ï¼Œå½“æœ‰Redisæ—¶ä¼˜å…ˆä½¿ç”¨Redisï¼Œå¦åˆ™ä½¿ç”¨å†…å­˜æˆ–æ–‡ä»¶ç³»ç»Ÿã€‚æ’ä»¶å¯ä»¥é€šè¿‡ç³»ç»Ÿæä¾›çš„ç¼“å­˜æ¥å£å®ç°é«˜æ•ˆçš„ç¼“å­˜ç®¡ç†ï¼Œæ— éœ€å…³å¿ƒç³»ç»Ÿè®¾ç½®ã€‚

- 1. ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨ï¼š
    ```python
    from app.core.cache import cached
    
    class MyPlugin(_PluginBase):
        @cached(region="my_plugin", ttl=3600)
        def get_data(self, key: str):
            """
            ä½¿ç”¨ç¼“å­˜è£…é¥°å™¨ï¼Œç¼“å­˜ç»“æœ1å°æ—¶
            """
            # å¤æ‚çš„è®¡ç®—æˆ–ç½‘ç»œè¯·æ±‚
            return expensive_operation(key)
        
        @cached(region="my_plugin_async", ttl=1800, skip_none=True)
        async def get_async_data(self, key: str):
            """
            å¼‚æ­¥å‡½æ•°ç¼“å­˜ï¼Œè·³è¿‡Noneå€¼
            """
            return await async_expensive_operation(key)
    ```

- 2. ä½¿ç”¨TTLCacheç±»ï¼š
    ```python
    from app.core.cache import TTLCache
    
    class MyPlugin(_PluginBase):
        def __init__(self):
            super().__init__()
            # åˆ›å»ºç¼“å­˜å®ä¾‹ï¼Œæœ€å¤§128é¡¹ï¼ŒTTL 30åˆ†é’Ÿ
            self.cache = TTLCache(region="my_plugin", maxsize=128, ttl=1800)
        
        def process_data(self, key: str):
            # æ£€æŸ¥ç¼“å­˜
            if key in self.cache:
                return self.cache[key]
            
            # è®¡ç®—å¹¶ç¼“å­˜ç»“æœ
            result = expensive_operation(key)
            self.cache[key] = result
            return result
        
        def clear_cache(self):
            """
            æ¸…ç†æ’ä»¶ç¼“å­˜
            """
            self.cache.clear()
    ```

- 3. ä½¿ç”¨æ–‡ä»¶ç¼“å­˜åç«¯ï¼ˆé€‚ç”¨äºå¤§æ–‡ä»¶ç¼“å­˜ï¼‰ï¼š
    ```python
    from app.core.cache import FileCache, AsyncFileCache
    from pathlib import Path
    
    class MyPlugin(_PluginBase):
        def __init__(self):
            super().__init__()
            # è·å–æ–‡ä»¶ç¼“å­˜åç«¯ï¼Œæ”¯æŒRediså’Œæ–‡ä»¶ç³»ç»Ÿ
            self.file_cache = FileCache(
                base=Path("/tmp/my_plugin_cache"),
                ttl=86400  # 24å°æ—¶
            )
        
        def cache_large_file(self, key: str, data: bytes):
            """
            ç¼“å­˜å¤§æ–‡ä»¶æ•°æ®
            """
            self.file_cache.set(key, data, region="large_files")
        
        def get_cached_file(self, key: str) -> Optional[bytes]:
            """
            è·å–ç¼“å­˜çš„æ–‡ä»¶æ•°æ®
            """
            return self.file_cache.get(key, region="large_files")
        
        async def async_cache_operations(self):
            """
            å¼‚æ­¥æ–‡ä»¶ç¼“å­˜æ“ä½œ
            """
            async_cache = AsyncFileCache(
                base=Path("/tmp/my_plugin_async_cache"),
                ttl=3600
            )
            
            # å¼‚æ­¥è®¾ç½®ç¼“å­˜
            await async_cache.set("async_key", b"async_data", region="async_files")
            
            # å¼‚æ­¥è·å–ç¼“å­˜
            data = await async_cache.get("async_key", region="async_files")
            
            await async_cache.close()
    ```

- 4. ç›´æ¥ä½¿ç”¨ç¼“å­˜åç«¯ï¼ˆé«˜çº§ç”¨æ³•ï¼‰ï¼š
    ```python
    from app.core.cache import Cache
    
    class MyPlugin(_PluginBase):
        def __init__(self):
            super().__init__()
            # ç›´æ¥è·å–ç¼“å­˜åç«¯å®ä¾‹ï¼Œç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©Redisæˆ–å†…å­˜ç¼“å­˜
            self.cache_backend = Cache(maxsize=256, ttl=3600)
        
        def custom_cache_operation(self, key: str, value: Any):
            """
            è‡ªå®šä¹‰ç¼“å­˜æ“ä½œ
            """
            # è®¾ç½®ç¼“å­˜
            self.cache_backend.set(key, value, region="custom_region")
            
            # æ£€æŸ¥ç¼“å­˜æ˜¯å¦å­˜åœ¨
            if self.cache_backend.exists(key, region="custom_region"):
                # è·å–ç¼“å­˜
                cached_value = self.cache_backend.get(key, region="custom_region")
                return cached_value
            
            return None
        
        def iterate_cache_items(self):
            """
            éå†ç¼“å­˜é¡¹
            """
            for key, value in self.cache_backend.items(region="custom_region"):
                print(f"ç¼“å­˜é”®: {key}, å€¼: {value}")
        
        def cleanup(self):
            """
            æ¸…ç†ç¼“å­˜
            """
            self.cache_backend.clear(region="custom_region")
            self.cache_backend.close()
    ```

- 5. ç¼“å­˜è£…é¥°å™¨å‚æ•°è¯´æ˜ï¼š
    ```python
    @cached(
        region="my_plugin",           # ç¼“å­˜åŒºåŸŸï¼Œç”¨äºéš”ç¦»ä¸åŒæ’ä»¶çš„ç¼“å­˜
        maxsize=512,                  # æœ€å¤§ç¼“å­˜æ¡ç›®æ•°ï¼ˆä»…å†…å­˜ç¼“å­˜æœ‰æ•ˆï¼‰
        ttl=1800,                     # ç¼“å­˜å­˜æ´»æ—¶é—´ï¼ˆç§’ï¼‰
        skip_none=True,               # æ˜¯å¦è·³è¿‡Noneå€¼ç¼“å­˜
        skip_empty=False              # æ˜¯å¦è·³è¿‡ç©ºå€¼ç¼“å­˜ï¼ˆç©ºåˆ—è¡¨ã€ç©ºå­—å…¸ç­‰ï¼‰
    )
    def my_function(self, param):
        pass
    ```

- 6. ç¼“å­˜ç®¡ç†åŠŸèƒ½ï¼š
    ```python
    class MyPlugin(_PluginBase):
        @cached(region="my_plugin")
        def cached_function(self, param):
            return expensive_operation(param)
        
        def clear_my_cache(self):
            """
            æ¸…ç†æŒ‡å®šåŒºåŸŸçš„ç¼“å­˜
            """
            self.cached_function.cache_clear()
        
        def get_cache_info(self):
            """
            è·å–ç¼“å­˜ä¿¡æ¯
            """
            cache_region = self.cached_function.cache_region
            return f"ç¼“å­˜åŒºåŸŸ: {cache_region}"
    ```

- 7. ç¼“å­˜åç«¯è‡ªåŠ¨é€‰æ‹©ï¼š
    - ç³»ç»Ÿä¼šæ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©ç¼“å­˜åç«¯ï¼š
        - `CACHE_BACKEND_TYPE=redis`ï¼šä½¿ç”¨Redisä½œä¸ºç¼“å­˜åç«¯
        - `CACHE_BACKEND_TYPE=memory`ï¼šä½¿ç”¨å†…å­˜ç¼“å­˜ï¼ˆcachetoolsï¼‰
    - æ’ä»¶ä»£ç æ— éœ€ä¿®æ”¹ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ç¼“å­˜åç«¯çš„åˆ‡æ¢

- 8. æœ€ä½³å®è·µï¼š
    - ä¸ºæ¯ä¸ªæ’ä»¶ä½¿ç”¨ç‹¬ç«‹çš„ç¼“å­˜åŒºåŸŸï¼ˆregionï¼‰ï¼Œé¿å…ç¼“å­˜é”®å†²çª
    - åˆç†è®¾ç½®TTLï¼Œé¿å…ç¼“å­˜è¿‡æœŸæ—¶é—´è¿‡é•¿å¯¼è‡´æ•°æ®è¿‡æœŸ
    - å¯¹äºé¢‘ç¹è®¿é—®çš„æ•°æ®ä½¿ç”¨è¾ƒé•¿çš„TTLï¼Œå¯¹äºå®æ—¶æ€§è¦æ±‚é«˜çš„æ•°æ®ä½¿ç”¨è¾ƒçŸ­çš„TTL
    - ä½¿ç”¨`skip_none=True`é¿å…ç¼“å­˜æ— æ„ä¹‰çš„Noneå€¼
    - å¤§æ–‡ä»¶æˆ–äºŒè¿›åˆ¶æ•°æ®å»ºè®®ä½¿ç”¨æ–‡ä»¶ç¼“å­˜åç«¯
    - åœ¨æ’ä»¶å¸è½½æ—¶æ¸…ç†ç›¸å…³ç¼“å­˜ï¼Œé¿å…å†…å­˜æ³„æ¼


## ç‰ˆæœ¬å‘å¸ƒ

### 1. å¦‚ä½•å‘å¸ƒæ’ä»¶ç‰ˆæœ¬ï¼Ÿ
- ä¿®æ”¹æ’ä»¶ä»£ç åï¼Œéœ€è¦ä¿®æ”¹`package.json`ä¸­çš„`version`ç‰ˆæœ¬å·ï¼ŒMoviePilotæ‰ä¼šæç¤ºç”¨æˆ·æœ‰æ›´æ–°ï¼Œæ³¨æ„ç‰ˆæœ¬å·éœ€è¦ä¸`__init__.py`æ–‡ä»¶ä¸­çš„`plugin_version`ä¿æŒä¸€è‡´ã€‚
- `package.json`ä¸­çš„`level`ç”¨äºå®šä¹‰æ’ä»¶ç”¨æˆ·å¯è§æƒé™ï¼Œ`1`ä¸ºæ‰€æœ‰ç”¨æˆ·å¯è§ï¼Œ`2`ä¸ºä»…è®¤è¯ç”¨æˆ·å¯è§ï¼Œ`3`ä¸ºéœ€è¦å¯†é’¥æ‰å¯è§ï¼ˆä¸€èˆ¬ç”¨äºæµ‹è¯•ï¼‰ã€‚å¦‚æœæ’ä»¶åŠŸèƒ½éœ€è¦ä½¿ç”¨åˆ°ç«™ç‚¹åˆ™åº”è¯¥ä¸º2ï¼Œå¦åˆ™å³ä½¿æ’ä»¶å¯¹ç”¨æˆ·å¯è§ä½†å› ä¸ºç”¨æˆ·æœªè®¤è¯ç›¸å…³åŠŸèƒ½ä¹Ÿæ— æ³•æ­£å¸¸ä½¿ç”¨ã€‚
- `package.json`ä¸­çš„`history`ç”¨äºè®°å½•æ’ä»¶æ›´æ–°æ—¥å¿—ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š
```json
{
  "history": {
    "v1.8": "ä¿®å¤ç©ºç›®å½•åˆ é™¤é€»è¾‘",
    "v1.7": "å¢åŠ å®šæ—¶æ¸…ç†ç©ºç›®å½•åŠŸèƒ½"
  }
}
```
- æ–°å¢åŠ çš„æ’ä»¶è¯·é…ç½®åœ¨`package.json`ä¸­çš„æœ«å°¾ï¼Œè¿™æ ·å¯è¢«è¯†åˆ«ä¸ºæœ€æ–°å¢åŠ ï¼Œå¯ç”¨äºç”¨æˆ·æ’åºã€‚
- é»˜è®¤é€šè¿‡éå†ä¸‹è½½é¡¹ç›®æ–‡ä»¶çš„æ–¹å¼å®‰è£…æ’ä»¶ï¼Œå¦‚æœæ’ä»¶æ–‡ä»¶è¾ƒå¤šï¼Œå¯ä»¥ä½¿ç”¨releaseçš„æ–¹å¼å‘å¸ƒæ’ä»¶ï¼Œpackageå¯¹åº”çš„æ’ä»¶æè¿°ä¸­å¢åŠ `release`å­—æ®µå¹¶è®¾ç½®ä¸º`true`ï¼Œæ­¤æ—¶æ’ä»¶å®‰è£…æ—¶ä¼šç›´æ¥ä¸‹è½½tagä¸º`æ’ä»¶ID_væ’ä»¶ç‰ˆæœ¬å·`çš„releaseåŒ…ï¼Œreleaseæ‰“åŒ…è„šæœ¬å‚ç…§æ’ä»¶ä»“åº“ä¸­çš„`release.yml`è„šæœ¬ã€‚
```json
{
  "release": true
}
```

### 2. å¦‚ä½•å¼€å‘V2ç‰ˆæœ¬çš„æ’ä»¶ä»¥åŠå®ç°æ’ä»¶å¤šç‰ˆæœ¬å…¼å®¹ï¼Ÿ

- è¯·å‚é˜… [V2ç‰ˆæœ¬æ’ä»¶å¼€å‘æŒ‡å—](./docs/V2_Plugin_Development.md)
